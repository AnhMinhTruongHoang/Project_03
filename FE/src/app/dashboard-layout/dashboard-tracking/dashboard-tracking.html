<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">

      <!-- Tiêu đề -->
      <div class="text-center mb-5">
        <h2 class="fw-bold text-primary">Tra cứu vận đơn</h2>
        <p class="text-muted">Nhập mã vận đơn để theo dõi hành trình giao hàng</p>
      </div>

      <!-- Form tra cứu -->
      <div class="card shadow-sm border-0 mb-5">
        <div class="card-body p-4">
          <form (ngSubmit)="search()" class="row g-3 align-items-center">
            <div class="col-md-9 col-12">
              <input
                type="text"
                class="form-control form-control-lg"
                placeholder="Nhập mã vận đơn (VD: VN123456789VN)"
                [(ngModel)]="waybill"
                name="waybill"
                required
                autofocus
                [disabled]="loading"
                uppercase
              />
            </div>
            <div class="col-md-3 col-12">
              <button
                type="submit"
                class="btn btn-primary btn-lg w-100"
                [disabled]="!waybill || loading"
              >
                <span *ngIf="!loading">
                  <i class="bi bi-search me-2"></i>Tra cứu
                </span>
                <span *ngIf="loading">
                  <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                  Đang tìm...
                </span>
              </button>
            </div>
          </form>

          <!-- Thông báo lỗi -->
          <div *ngIf="error" class="alert alert-danger mt-3 mb-0">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            {{ error }}
          </div>
        </div>
      </div>

      <!-- Kết quả tra cứu -->
      <ng-container *ngIf="trackingEvents.length > 0">
        <!-- Thông tin tổng quan -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-body">
            <div class="row text-center text-md-start">
              <div class="col-md-4 mb-3">
                <small class="text-muted text-uppercase">Mã vận đơn</small>
                <h5 class="fw-bold text-primary">{{ trackingData?.waybill || waybill }}</h5>
              </div>
              <div class="col-md-4 mb-3">
                <small class="text-muted text-uppercase">Trạng thái hiện tại</small>
                <h5 class="fw-bold" [ngClass]="getCurrentStatusColor()">
                  {{ getCurrentStatusLabel() }}
                </h5>
              </div>
              <div class="col-md-4 mb-3">
                <small class="text-muted text-uppercase">Cập nhật lúc</small>
                <h6 class="mb-0">{{ latestUpdate | date:'HH:mm, ngày dd/MM/yyyy' }}</h6>
              </div>
            </div>
          </div>
        </div>

        <!-- Timeline hành trình -->
        <div class="card shadow-sm border-0">
          <div class="card-header bg-white border-0 py-3">
            <h5 class="fw-bold mb-0 text-primary">
              <i class="bi bi-truck me-2"></i>Hành trình vận đơn
            </h5>
          </div>
          <div class="card-body">
            <div class="timeline-modern">
              <div
                class="timeline-item"
                *ngFor="let event of trackingEvents; let i = index; let isLast = last"
              >
                <!-- Đường nối -->
                <div class="timeline-connector" [class.completed]="i < currentStepIndex"></div>

                <!-- Điểm tròn trạng thái -->
                <div
                  class="timeline-dot"
                  [class.active]="i === currentStepIndex"
                  [class.completed]="i < currentStepIndex"
                >
                  <i [class]="getStatusIcon(event.status) + ' text-white'"></i>
                </div>

                <!-- Nội dung -->
                <div class="timeline-content" [class.active]="i === currentStepIndex">
                  <h6 class="fw-bold mb-1" [ngClass]="getStatusTextClass(event.status)">
                    {{ getStatusLabel(event.status) }}
                  </h6>
                  <p class="text-muted small mb-2">
                    {{ event.timestamp | date:'HH:mm, ngày dd/MM/yyyy' }}
                  </p>

                  <p class="mb-1" *ngIf="event.location">
                    <i class="bi bi-geo-alt-fill me-1"></i>
                    <strong>Địa điểm:</strong> {{ event.location }}
                  </p>

                  <p class="mb-1" *ngIf="event.branchId?.name">
                    <i class="bi bi-building-fill me-1"></i>
                    <strong>Chi nhánh:</strong> {{ event.branchId.name }}
                  </p>

                  <p class="mb-0 text-muted small" *ngIf="event.note">
                    <strong>Ghi chú:</strong> {{ event.note }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- Trạng thái: Chưa nhập mã hoặc chưa tra cứu -->
      <div
        *ngIf="!trackingEvents.length && !loading && !error && waybill"
        class="text-center py-5"
      >
        <i class="bi bi-search display-1 text-muted opacity-50"></i>
        <p class="text-muted mt-4 fs-5">Nhấn nút <strong>Tra cứu</strong> để xem hành trình</p>
      </div>

      <!-- Trạng thái: Chưa nhập gì -->
      <div
        *ngIf="!waybill && !loading && !error"
        class="text-center py-5 text-muted"
      >
        <i class="bi bi-box-seam display-1 opacity-25"></i>
        <p class="mt-4 fs-4">Nhập mã vận đơn để bắt đầu tra cứu</p>
      </div>

    </div>
  </div>
</div>